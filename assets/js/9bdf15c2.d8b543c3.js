"use strict";(self.webpackChunkskyrimnet_docs=self.webpackChunkskyrimnet_docs||[]).push([[8549],{4480:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"Memory System/sqlite-storage","title":"SQLite storage","description":"SkyrimNet uses a persistent, lightweight SQLite database to store NPC memories, enabling characters to remember events across sessions \u2014 even after saving, quitting, or rebooting the game.","source":"@site/docs/Memory System/SQLite storage.md","sourceDirName":"Memory System","slug":"/Memory System/sqlite-storage","permalink":"/SkyrimNet-GamePlugin/Memory System/sqlite-storage","draft":false,"unlisted":false,"editUrl":"https://github.com/MinLL/skyrimnet/edit/main/docs/docs/Memory System/SQLite storage.md","tags":[],"version":"current","frontMatter":{"id":"sqlite-storage","title":"SQLite storage","displayed_sidebar":"tutorialSidebar"},"sidebar":"tutorialSidebar","previous":{"title":"Suggested LLMs","permalink":"/SkyrimNet-GamePlugin/Large Language Models/suggested-llms"},"next":{"title":"Memory System","permalink":"/SkyrimNet-GamePlugin/Memory System/memory-recall"}}');var s=r(4848),t=r(8453);const l={id:"sqlite-storage",title:"SQLite storage",displayed_sidebar:"tutorialSidebar"},d="\ud83d\uddc4\ufe0f SkyrimNet Memory Storage System (SQLite-Based)",o={},a=[{value:"\ud83e\uddf1 What is SQLite?",id:"-what-is-sqlite",level:2},{value:"\ud83e\udde0 Memory Table Structure",id:"-memory-table-structure",level:2},{value:"Example Schema",id:"example-schema",level:3},{value:"\ud83e\uddec Embedding Storage",id:"-embedding-storage",level:2},{value:"\ud83d\udd01 Writing &amp; Updating",id:"-writing--updating",level:2},{value:"Memory Creation:",id:"memory-creation",level:3},{value:"Memory Pruning:",id:"memory-pruning",level:3},{value:"Memory Updates:",id:"memory-updates",level:3},{value:"\ud83d\udd0d Querying",id:"-querying",level:2},{value:"\u2699\ufe0f Performance Notes",id:"\ufe0f-performance-notes",level:2},{value:"\ud83d\udd27 Storage",id:"-storage",level:3},{value:"\ud83d\udcca Retrieval Logic",id:"-retrieval-logic",level:3},{value:"Retrieval Thresholds",id:"retrieval-thresholds",level:4},{value:"\ud83e\udde0 Memory Generation",id:"-memory-generation",level:3},{value:"\ud83d\udca1 Example Use Case",id:"-example-use-case",level:2}];function c(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\ufe0f-skyrimnet-memory-storage-system-sqlite-based",children:"\ud83d\uddc4\ufe0f SkyrimNet Memory Storage System (SQLite-Based)"})}),"\n",(0,s.jsxs)(n.p,{children:["SkyrimNet uses a persistent, lightweight ",(0,s.jsx)(n.strong,{children:"SQLite database"})," to store NPC memories, enabling characters to remember events across sessions \u2014 even after saving, quitting, or rebooting the game."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-what-is-sqlite",children:"\ud83e\uddf1 What is SQLite?"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"SQLite"})," is a fast, file-based database engine that stores structured data in a single ",(0,s.jsx)(n.code,{children:".db"})," file \u2014 no server required."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Zero configuration"})," \u2014 it runs in-process with your game or mod."]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Cross-platform"})," \u2014 works on Windows, Linux, and Steam Deck."]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Reliable and lightweight"})," \u2014 used by apps like Firefox, Discord, and Android."]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"SQL-compliant"})," \u2014 allows rich querying and filtering via standard SQL syntax."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["In SkyrimNet, this means you get ",(0,s.jsx)(n.strong,{children:"permanent memory storage"})," that:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Survives between game loads"}),"\n",(0,s.jsx)(n.li,{children:"Supports fast search and recall"}),"\n",(0,s.jsx)(n.li,{children:"Doesn't require external services or internet"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-memory-table-structure",children:"\ud83e\udde0 Memory Table Structure"}),"\n",(0,s.jsxs)(n.p,{children:["Each NPC memory is stored as a row in the ",(0,s.jsx)(n.code,{children:"memories"})," table."]}),"\n",(0,s.jsx)(n.h3,{id:"example-schema",children:"Example Schema"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE memories (\r\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n  actor_uuid TEXT NOT NULL,\r\n  memory_type TEXT,              -- EXPERIENCE, RELATIONSHIP, etc.\r\n  content TEXT,                  -- Main narrative summary\r\n  details TEXT,                  -- Optional longer description\r\n  emotion TEXT,                  -- e.g., fearful, joyful, angry\r\n  importance_score REAL,         -- Between 0.0 and 1.0\r\n  location TEXT,                 -- Specific place (e.g., "Whiterun Market")\r\n  tags TEXT,                     -- Serialized array (JSON or comma-separated)\r\n  embedding BLOB,                -- 384-dimensional float vector (MiniLM-L6-v2)\r\n  game_time INTEGER,            -- When this memory occurred\r\n  timestamp INTEGER DEFAULT CURRENT_TIMESTAMP\r\n); \r\n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"-embedding-storage",children:"\ud83e\uddec Embedding Storage"}),"\n",(0,s.jsxs)(n.p,{children:["Each memory is embedded as a ",(0,s.jsx)(n.strong,{children:"384-dimensional vector"})," using ",(0,s.jsx)(n.strong,{children:"MiniLM-L6-v2"}),". This vector is stored in a ",(0,s.jsx)(n.code,{children:"BLOB"})," field, enabling ",(0,s.jsx)(n.strong,{children:"fast similarity search"})," via a vector index (e.g., FAISS or HNSW)."]}),"\n",(0,s.jsx)(n.p,{children:"This allows SkyrimNet to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Retrieve memories by ",(0,s.jsx)(n.strong,{children:"semantic similarity"})]}),"\n",(0,s.jsxs)(n.li,{children:["Rank relevant memories for ",(0,s.jsx)(n.strong,{children:"behavior"})," or ",(0,s.jsx)(n.strong,{children:"dialogue"})]}),"\n",(0,s.jsxs)(n.li,{children:["Perform ",(0,s.jsx)(n.strong,{children:"emotionally and contextually aware recall"})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-writing--updating",children:"\ud83d\udd01 Writing & Updating"}),"\n",(0,s.jsx)(n.h3,{id:"memory-creation",children:"Memory Creation:"}),"\n",(0,s.jsx)(n.p,{children:"After a memory segment is generated (via the LLM), it's written into the SQLite DB if:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"importance_score >= 0.2"})}),"\n",(0,s.jsx)(n.li,{children:"It passes internal relevance filters"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"memory-pruning",children:"Memory Pruning:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Each actor can store up to ",(0,s.jsx)(n.strong,{children:"1000 memories"})]}),"\n",(0,s.jsx)(n.li,{children:"Low-importance memories are purged first"}),"\n",(0,s.jsx)(n.li,{children:"This is configurable in SkyrimNet's settings"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"memory-updates",children:"Memory Updates:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Memories can be ",(0,s.jsx)(n.strong,{children:"edited post-generation"})," (e.g., emotion corrected)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tags can be updated"})," dynamically to support evolving gameplay"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-querying",children:"\ud83d\udd0d Querying"}),"\n",(0,s.jsxs)(n.p,{children:["SkyrimNet queries memory using ",(0,s.jsx)(n.strong,{children:"hybrid filtering"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Vector similarity"})," (via the embedding)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SQL filters"})," (e.g., by actor, emotion, tag, or location)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Time-based filters"})," (e.g., \u201cmemories within the last day\u201d)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This enables NPCs to recall things like:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u201cWhat have I seen the Prisoner do in Whiterun?\u201d"}),"\n",(0,s.jsx)(n.li,{children:"\u201cHave I ever felt fear around dragons?\u201d"}),"\n",(0,s.jsx)(n.li,{children:"\u201cWhen did I last talk to Iggwilv?\u201d"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-performance-notes",children:"\u2699\ufe0f Performance Notes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Thread-safe"}),": SQLite access is wrapped in safe async calls"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Low overhead"}),": Indexing and embedding is lightweight (~1ms per memory)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Optimized for read-heavy workloads"})," \u2014 ideal for real-time recall during gameplay"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"SkyrimNet's memory system is a hybrid architecture involving vector-based semantic storage, keyword tagging, actor-event tracking, and SQLite-based persistence."}),"\n",(0,s.jsx)(n.h3,{id:"-storage",children:"\ud83d\udd27 Storage"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Embedding Model"}),": ",(0,s.jsx)(n.code,{children:"MiniLM-L6-v2"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Vector Dimension"}),": ",(0,s.jsx)(n.code,{children:"384"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Backend"}),": SQLite with HNSW vector index for fast approximate search"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"HNSW Parameters"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ef_construction"}),": ",(0,s.jsx)(n.code,{children:"200"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"M"}),": ",(0,s.jsx)(n.code,{children:"16"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"-retrieval-logic",children:"\ud83d\udcca Retrieval Logic"}),"\n",(0,s.jsx)(n.p,{children:"Memory retrieval uses a weighted scoring function that considers:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Weight Type"}),(0,s.jsx)(n.th,{children:"Value"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Semantic Similarity"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"0.35"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Temporal Proximity"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"0.20"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Actor Involvement"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"0.20"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Emotional Resonance"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"0.10"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Keyword Relevance"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"0.10"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Location Proximity"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"0.05"})})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"retrieval-thresholds",children:"Retrieval Thresholds"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Minimum Similarity Score"}),": ",(0,s.jsx)(n.code,{children:"0.519999981"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Minimum Relevance Score"}),": ",(0,s.jsx)(n.code,{children:"0.569999993"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Minimum Keyword Relevance"}),": ",(0,s.jsx)(n.code,{children:"0.180000007"})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"-memory-generation",children:"\ud83e\udde0 Memory Generation"}),"\n",(0,s.jsx)(n.p,{children:"Memories are generated from in-game events segmented by time and density:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Max Time Gap Between Events"}),": ",(0,s.jsx)(n.code,{children:"60"})," minutes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Min Segment Duration"}),": ",(0,s.jsx)(n.code,{children:"10"})," minutes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Max Segment Duration"}),": ",(0,s.jsx)(n.code,{children:"480"})," minutes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Min Events Per Segment"}),": ",(0,s.jsx)(n.code,{children:"5"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Max Events Per Segment"}),": ",(0,s.jsx)(n.code,{children:"200"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Min Importance to Store"}),": ",(0,s.jsx)(n.code,{children:"0.2"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Each memory stores:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Actor UUID"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Memory Type"})," (e.g. ",(0,s.jsx)(n.code,{children:"EXPERIENCE"}),", ",(0,s.jsx)(n.code,{children:"FACT"}),", ",(0,s.jsx)(n.code,{children:"DIALOGUE"}),")"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Text Content"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Importance (0\u20131.0)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Emotion Label"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Location"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Related Actors"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Related Event IDs"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Tags"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-example-use-case",children:"\ud83d\udca1 Example Use Case"}),"\n",(0,s.jsx)(n.p,{children:"A vampire NPC sees a player feed on a bandit. SkyrimNet logs the event and builds a memory:"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:'"I saw the prisoner feed on a Wood Elf bandit under the moonlight. Their bloodlust awakened something... familiar."'}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This memory can now influence future dialogue, attitude, or AI behavior."}),"\n",(0,s.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>d});var i=r(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);